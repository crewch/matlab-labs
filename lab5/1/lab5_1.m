%% 1. Загрузка исходного изображения
f = load('A5_07_1.mat', '-ascii');
f = double(f); % Преобразование к double
f_norm = mat2gray(f); % Нормировка в диапазон [0,1]

% Отображение исходного изображения
figure;
imshow(f_norm, []);
title('Исходное изображение (пространственная область)');
imwrite(f_norm, 'task5_07_original.jpg');

%% 2. Прямое двумерное ДПФ и спектры
F = fft2(f); % Двумерное ДПФ

% Амплитудный спектр с логарифмическим преобразованием
Amp = abs(F);
AmpL = log(1 + Amp);
AmpL_norm = mat2gray(AmpL);

% Фазовый спектр (нормировка в [0,1])
Ph = angle(F);
PhN = (Ph + pi) / (2*pi);

% Отображение и сохранение спектров
figure;
imshow(AmpL_norm, []);
title('Амплитудный спектр исходного изображения');
imwrite(AmpL_norm, 'task5_07_spectrum_amp_original.jpg');

figure;
imshow(PhN, []);
title('Фазовый спектр исходного изображения');
imwrite(PhN, 'task5_07_spectrum_phase_original.jpg');

%% 3. Сдвиг изображения через спектр Фурье
dx = 40; % сдвиг вправо (по столбцам)
dy = 100; % сдвиг вниз (по строкам)

[rows, cols] = size(f);
[u, v] = meshgrid(0:cols-1, 0:rows-1);

% Фазовый множитель сдвига (свойство Фурье)
shift_factor = exp(-1i*2*pi*(u*dx/cols + v*dy/rows));

% Применение сдвига в частотной области
F_shift = F .* shift_factor;
f_shift = real(ifft2(F_shift)); % Обратное ДПФ + удаление мнимой части
f_shift_norm = mat2gray(f_shift);

% Отображение сдвинутого изображения
figure;
imshow(f_shift_norm, []);
title('Сдвинутое изображение (40 вправо, 100 вниз)');
imwrite(f_shift_norm, 'task5_07_shifted_image.jpg');

%% 4. Спектры сдвинутого изображения
% Амплитудный спектр
Amp_shift = abs(F_shift);
AmpL_shift = log(1 + Amp_shift);
AmpL_shift_norm = mat2gray(AmpL_shift);

% Фазовый спектр
Ph_shift = angle(F_shift);
PhN_shift = (Ph_shift + pi) / (2*pi);

% Отображение и сохранение спектров сдвинутого изображения
figure;
imshow(AmpL_shift_norm, []);
title('Амплитудный спектр сдвинутого изображения');
imwrite(AmpL_shift_norm, 'task5_07_spectrum_amp_shifted.jpg');

figure;
imshow(PhN_shift, []);
title('Фазовый спектр сдвинутого изображения');
imwrite(PhN_shift, 'task5_07_spectrum_phase_shifted.jpg');

%% Анализ результатов:
% 1. Амплитудные спектры исходного и сдвинутого изображений ИДЕНТИЧНЫ.
%    Это следует из свойства инвариантности амплитудного спектра к сдвигу.
%
% 2. Фазовые спектры демонстрируют линейное изменение (поворот),
%    что соответствует смещению изображения в пространственной области.
%    Математически это проявляется в добавлении линейной компоненты
%    к фазовому спектру: phi_shift(u,v) = phi(u,v) - 2*pi*(u*dx/M + v*dy/N).
%
% 3. Логарифмическое преобразование амплитуды необходимо для визуализации
%    низкочастотных компонент, которые доминируют в спектре изображений.
%
% 4. Фазовый спектр содержит информацию о положении объектов в изображении,
%    в то время как амплитудный спектр определяет общую структуру.
